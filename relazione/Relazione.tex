\documentclass[12pt]{article}
\usepackage{titling}
\usepackage{graphicx}
\usepackage{caption}
\usepackage{helvet}
\usepackage{hyperref}
\usepackage{bookmark}
\usepackage{framed}
\usepackage{listings}
\usepackage{mdframed}
\usepackage{sectsty}
\usepackage{tikz}
\usepackage{amssymb}
\newcommand{\abs}[1]{\left|#1\right|}

\renewcommand{\lstlistingname}{}

% Define font size and family for sections
\sectionfont{\fontsize{12}{14}\selectfont\renewcommand{\familydefault}{\sfdefault}}
\subsectionfont{\fontsize{12}{14}\selectfont\renewcommand{\familydefault}{\sfdefault}}
\subsubsectionfont{\fontsize{12}{14}\selectfont\renewcommand{\familydefault}{\sfdefault}}
\paragraphfont{\fontsize{12}{14}\selectfont\renewcommand{\familydefault}{\sfdefault}}
\subparagraphfont{\fontsize{12}{14}\selectfont\renewcommand{\familydefault}{\sfdefault}}
\renewcommand{\familydefault}{\rmdefault} % Reset default to Roman for title page

\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{hyperref}

\lstset{
    basicstyle=\ttfamily\footnotesize,
    keywordstyle=\color{purple},
    commentstyle=\color{green},
    stringstyle=\color{blue},
    frame=single,
    breaklines=true,
    keepspaces=true,
    showspaces=false,
    showstringspaces=false
}


\begin{document}

% Prima pagina
\begin{titlepage}
    \centering
    {\Huge \textbf{Università degli Studi di Padova} \par}
    \vspace{1cm}
    \begin{figure}[h!]
        \centering
        \includegraphics[width=0.5\textwidth]{Immagini/Logo_Università_Padova.png}
    \end{figure}
    \vspace{0.5cm}
    {\LARGE \textbf{Relazione per:} \par}
    {\Huge Ricerca Operativa \par}
    \vspace{0.5cm}
    {\Large \textit{\textbf{Per Simulare una:}} \par}
    {\Large Minimizzare il numero di turni per sconfiggere un Boss nei giochi RPG \par}
    \vfill
    \textbf{Realizzata da:} \par
    Gabriele Di Pietro, matricola 2010000 \par
    \vspace{0.5cm}
    \textbf{GitHub Repository:} \par
    \texttt{\url{https://github.com/SerpenTaki/ProgettoRO-2025}}
\end{titlepage}
    % Change font and size for the rest of the document
    \renewcommand{\familydefault}{\sfdefault} % Set default to sans serif
    \fontsize{10}{12}\selectfont
    % Pagina introduzione
    \newpage
    \section{Introduzione}
    \subsection{Abstract}
    Si presenta un problema di ottimizzazione strategica nei giochi RPG dove il giocatore deve comporre un team di personaggi per minimizzare il numero di turni impiegati per uccidere un eventuale boss.\\
    \subsection{Descrizione del problema}
    Per un gioco di ruolo il giocatore può scegliere di comporre un team di personaggi.
    Ogni \textit{party}\footnote{Insieme di cavalieri e maghi che compongono il team.} è formato da 3 personaggi scelti tra Cavalieri e Maghi. Questo significa che un team può essere formato da 3 Cavalieri, 3 Maghi o da un misto di entrambi. 
    La stamina e il mana sono statistiche separate ma condivise tra i personaggi; in generale
    il mana viene usato dai Maghi, mentre la stamina dai Cavalieri.
    I 3 personaggi possono decidere di attaccare durante lo stesso turno o di non attaccare per quello specifico turno per recuperare un certo quantitativo di mana e stamina.
    I Cavalieri, quando attaccano, possono decidere di usare la spada con 2 mani consumando il 75\% di stamina in più ma infliggendo il doppio dei danni. Mentre i Maghi, decidendo di non attaccare, potenziano l'attacco dei Cavalieri del 20\% in più per i 2 turni successivi. Non è possibile che 2 Maghi si riposino nello stesso turno. Si vuole minimizzare il numero di turni totali per uccidere un grande mostro con un determinato quantitativo di vita. Sapendo che:
    \begin{itemize}
        \item Un Boss ha un certo numero di punti vita;
        \item Nei turni di riposo il mago ripristina il 20$\%$ di mana consumato;
        \item Nei turni di riposo il cavaliere ripristina il 30$\%$ di stamina consumata;
        \item Il boost del cavaliere ottenuto dal mago che si riposa aumenta del 20$\%$ il danno base con una mano che il cavaliere infligge;
    \end{itemize}

    \section{Modello}
    \subsection{Insiemi}
    \begin{itemize}
        \item $T$: Insieme dei turni possibili, con $t \in T \subseteq \mathbb{Z}^+$
        \item $K$: Insieme dei cavalieri, con $k \in K \subseteq \mathbb{Z}^+$ e $k = \{ 0,1,2,3 \}$
        \item $W$: Insieme dei maghi, con $w \in W \subseteq \mathbb{Z}^+$ e $w = 3- k$
    \end{itemize}
    \subsection{Parametri}
    \begin{itemize}
        \item $PV_{Boss}$: punti vita del Boss
        \item $DK$: danno che un cavaliere può infliggere
        \item $DW$: danno che un mago può infliggere
        \item $SKC$: consumo di stamina da parte di un cavaliere
        \item $MWC$: consumo di mana da parte di un mago
        \item $S_{max}$: stamina massima del team
        \item $M_{max}$: mana massimo del team
        \item $S_{min}$: stamina minima del team $=0$
        \item $M_{min}$: mana minima del team $=0$
    \end{itemize}
   \subsection{Variabili decisionali}
   \begin{itemize}
    \item $S_t$: Stamina disponibile all'inizio del turno
    \item $M_t$: Mana disponibile all'inizio del turno
    \item $DPT_t$: Danno per turno, quindi il danno totale inflitto dal \textit{party} al turno $t$
    \item $x_{k,t} = \begin{cases} 
        1 & \text{se il cavaliere } k \text{ attacca al turno } t \\ 
        0 & \text{altrimenti} 
    \end{cases}$
    \item $y_{k,t} = \begin{cases} 
        1 & \text{se il cavaliere } k \text{ usa 2 mani per attaccare } \\ 
        0 & \text{altrimenti} 
    \end{cases}$
    \item $z_{w,t} = \begin{cases} 
        1 & \text{se il mago } w \text{ attacca nel turno } t \\ 
        0 & \text{altrimenti} 
    \end{cases}$
    \item $Boost_t = \begin{cases}
        1 & \text{ se } \text{un mago si è riposato in uno dei 2 turni precedenti } \\
        0 & \text{ altrimenti }
    \end{cases}$
    \item $u_t = \begin{cases}
        1 & \text{se il boss è stato sconfitto nel turno } t \\
        0 & \text{altrimenti}
    \end{cases}$
    \end{itemize}
   \subsection{Funzione obiettivo}
    \begin{equation}
        \min \sum_{t \in T} t \cdot u_t
    \end{equation}
    L'obiettivo è quello di trovare il turno minimo in cui il boss viene sconfitto. Quindi sommiamo tutti i turni ma solo quello dove viene sconfitto non va a 0.\\

    \subsubsection{Vincoli}
La stamina e il mana sono valori che si aggiornano in base al consumo (\textit{durante la fase di attacco}) o alla ricarica (\textit{durante la fase di riposo}).\\
    \begin{tabular*}{\textwidth}{@{\extracolsep{\fill}} ll}
        \\
        $S_{t} \geq S_{min}$ \hspace{1cm} $S_{t} \leq S_{max}$ \hspace{1cm} $M_{t} \geq M_{min}$ \hspace{1cm} $M_{t} \leq M_{max}$  & $\forall t$ \\
        \\
        $y_{k,t} \leq x_{k,t}$ & $\forall k,t$ \\
        & \\
        $\sum_{k \in K} SKC(x_{k,t} + 0.75 y_{k,t}) \leq S_t$ & $\forall t$ \\
        & \\
        $\sum_{w \in W} z_{w,t} \cdot MWC \leq M_t$ & $\forall t$ \\
        & \\
       $S_{t+1} = S_t - \sum_{k \in K} SKC (x_{k,t} +0.75 y_{k,t}) + 0.3 \cdot r_{k,t}$ & $\forall k,t$ \\
       & \\
       $M_{t+1} = M_t - \sum_{w \in W} z_{w,t} \cdot MWC + 0.2 \cdot \gamma_{w,t}$ & $\forall w,t$ \\
         & \\
    \end{tabular*}
    dove definiamo $r$ e $\gamma$ come 2 variabili ausiliarie usate per linearizzare il vincolo di riposo dei cavalieri e maghi, e sono soggette a:\\
    \begin{tabular*}{\textwidth}{@{\extracolsep{0pt}} ll}
        \\
    $r_{k,t} \leq S_{max} (1-x_{k,t})$ \hspace{2cm} & $\gamma_{w,t} \leq M_{max} (1-z_{w,t})$ \\
    \\
    $r_{k,t} \geq (S_{max}-S_t) - M \cdot x_{k,t}$ \hspace{2cm} & $\gamma_{w,t} \geq (M_{max}-{M_t}) - M \cdot z_{w,t}$ \\
    \\
    $r_{k,t} \leq S_{max}-S_t $ \hspace{2cm} & $\gamma_{w,t} \leq M_{max}-M_t$ \\
    \\
    $r_{k,t} \geq 0$ \hspace{2cm} & $\gamma_{w,t} \geq 0$ \\
    \\
    \end{tabular*}
    Dove $M$ è un numero sufficientemente grande per garantire che il vincolo sia soddisfatto, ad esempio $M=S_{max}$.\\
    \newpage
    Vincoli sul danno e sulla condizione di vittoria\\ 
    \begin{tabular*}{\textwidth}{@{\extracolsep{\fill}} ll}\\
        $Boost_t \leq \sum_{w \in W}((1-z_{w,t-1})+(1-z_{w,t-2}))$ & $\forall t$ \\
        & \\
        $z_{m,t-1} + z_{m,t-2} \leq 1$ & $\forall t$\\
       & \\
        $DPT_t = (\sum_{k \in K} DK \cdot (x_{k,t} + y_{k,t} + (0.2 Boost_{t}))) + \sum_{w \in W} z_{w,t} \cdot DW$ & $\forall t$\\
        & \\
        $\sum_{t=1}^t DPT_t \geq PV_{Boss} \cdot u_t$ & $\forall t$ \\
        & \\
    \end{tabular*}
    Vincolo di riposo dei maghi, in un turno solo 1 mago \\
    \begin{tabular*}{\textwidth}{@{\extracolsep{\fill}} ll}
        \\
        $\sum_{w \in W}(1-z_{w,t}) \leq 1$ & $\forall t$ \\
        \\
    \end{tabular*}

    Solo un turno può essere quello in cui il boss viene sconfitto \\
    \begin{tabular*}{\textwidth}{@{\extracolsep{\fill}} ll}
        \\
        $\sum_{t \in T} u_t = 1$  & $\forall$\\
        \\
    \end{tabular*}

    Domini:\\
    \begin{tabular*}{\textwidth}{@{\extracolsep{\fill}} l}\\
        $x_{k,t}, y_{k,t}, z_{w,t}, u_t, Boost_t \in \{0,1\}$ in $\mathbb{Z}^+$\\
         \\
         $S_t, M_t, DPT_t \geq 0, \text{ con  } S_t, M_t, DPT_t \in \mathbb{R}^+$\\
    \end{tabular*}
    


    \newpage
    \section{Implementazione}
    \subsection{File .mod}
\begin{lstlisting}[language=haskell, frame=single, caption={Modello in Ampl}, captionpos=b, keywordstyle=\color{purple}]  
set T ordered;
set K; 
set W;

param PVBoss;
param DK;
param DW;
param SKC;
param MWC;
param Smax;
param Mmax;
param Smin;
param Mmin;
param BigM := 100;

var St{T} >= 0;
var Mt{T} >= 0;
var DPT{T} >= 0;

var x{k in K, t in T} binary;  
var y{k in K, t in T} binary;  
var z{w in W, t in T} binary;  
var Boost{T} binary;
var u{T} binary;

var r{k in K, t in T} >= 0;    
var gamma{w in W, t in T} >= 0; 

minimize TurniMinimi:
    sum {t in T} t * u[t];

subject to StaminaMin {t in T: t != last(T)}: 
    St[t] >= Smin;

subject to StaminaMax {t in T: t != last(T)}: 
    St[t] <= Smax;

subject to ManaMin {t in T: t != last(T)}: 
    Mt[t] >= Mmin;

subject to ManaMax {t in T: t != last(T)}: 
    Mt[t] <= Mmax;

subject to Attacco2mani{k in K, t in T}:
    y[k,t] <= x[k,t];

subject to ConsumoStamina{t in T}:
    sum{k in K} SKC * (x[k,t] + 0.75 * y[k,t]) <= St[t];

subject to ConsumoMana{t in T}:
    sum{w in W} z[w,t] * MWC <= Mt[t];

subject to AggiornaStamina{t in T: ord(t) < card(T)}:
    St[t+1] = St[t] - sum{k in K} SKC * (x[k,t] + 0.75 * y[k,t]) + 0.3 * sum{k in K} r[k,t];

subject to AggiornaMana{t in T: ord(t) < card(T)}:
    Mt[t+1] = Mt[t] - sum{w in W} z[w,t] * MWC + 0.2 * sum{w in W} gamma[w,t];

subject to RiposoCavaliere1 {k in K, t in T}:
    r[k,t] <= Smax * (1 - x[k,t]);

subject to RiposoCavaliere2 {k in K, t in T}:
    r[k,t] >= (Smax - St[t]) - BigM * x[k,t];

subject to RiposoCavaliere3 {k in K, t in T}:
    r[k,t] <= Smax - St[t];

subject to RiposoMago1 {w in W, t in T}:
    gamma[w,t] <= Mmax * (1 - z[w,t]);

subject to RiposoMago2 {w in W, t in T}:
    gamma[w,t] >= (Mmax - Mt[t]) - BigM * z[w,t];

subject to RiposoMago3 {w in W, t in T}:
    gamma[w,t] <= Mmax - Mt[t];

subject to BoostCondition {t in T: ord(t) > 2}:
    Boost[t] <= sum {w in W} (1 - z[w,t-1] + 1 - z[w,t-2]);

subject to UnoRiposaPerTurno {t in T}:
    sum {w in W} (1 - z[w,t]) <= 1;



subject to DannoPerTurno {t in T}:
    DPT[t] = sum{k in K} DK * (x[k,t] + y[k,t] + 0.2 * Boost[t]) + sum{w in W} z[w,t] * DW;

subject to BossSconfitto {t in T}:
    sum{tt in T: ord(tt) <= ord(t)} DPT[tt] >= PVBoss * u[t];

subject to SoloUnTurno:
    sum{t in T} u[t] = 1;
\end{lstlisting}

\subsection{File .run}
\begin{lstlisting}[language=haskell, frame=single, caption={File di esecuzione}, captionpos=b, keywordstyle=\color{purple}]  
reset;
model file.mod;
data Dati/file.dat; # cambiare il nome del file.dat per selezionare lo scenario
option solver gurobi;
solve;
    
display TurniMinimi; 
display u, DPT, St, Mt;
\end{lstlisting}


    \section{Primo scenario}
    \subsection{File .dat}
    \subsection{Risultati}
    \section{Secondo scenario}
    \subsection{File .dat}
    \subsection{Risultati}
\end{document}
